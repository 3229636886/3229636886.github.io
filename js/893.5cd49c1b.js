"use strict";(self["webpackChunkblog_vue"]=self["webpackChunkblog_vue"]||[]).push([[893],{1893:function(t,e,s){s.r(e),s.d(e,{default:function(){return c}});var a=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"add-blog"}},[t.submitSuccess?t._e():e("el-card",{attrs:{id:"add-blog-card"}},[e("h1",{staticClass:"page-title"},[t._v("添加博客")]),e("el-form",{ref:"formRef",attrs:{model:t.formData,"label-position":"top",rules:t.rules}},[e("el-form-item",{attrs:{label:"标题",prop:"title"}},[e("el-input",{attrs:{type:"text",placeholder:"请输入标题",maxlength:"50","show-word-limit":"",clearable:""},model:{value:t.formData.title,callback:function(e){t.$set(t.formData,"title",e)},expression:"formData.title"}})],1),e("el-form-item",{attrs:{label:"描述",prop:"intro"}},[e("el-input",{attrs:{type:"text",placeholder:"请进行简要描述",maxlength:"100","show-word-limit":"",clearable:""},model:{value:t.formData.intro,callback:function(e){t.$set(t.formData,"intro",e)},expression:"formData.intro"}})],1),e("el-form-item",{attrs:{label:"内容",prop:"content"}},[e("mavon-editor",{ref:"editorRef",staticStyle:{"min-height":"600px"},on:{save:t.saveContent,imgAdd:t.imgAdd,imgDel:t.imdDel},model:{value:t.formData.content,callback:function(e){t.$set(t.formData,"content",e)},expression:"formData.content"}})],1),e("el-form-item",{attrs:{prop:"categories",label:"分类"}},[t._l(t.formData.categories,(function(s){return e("el-tag",{key:s,attrs:{closable:"","disable-transitions":!1},on:{close:function(e){return t.handleClose(s)}}},[t._v(" "+t._s(s)+" ")])})),t.inputVisible?e("el-input",{ref:"TagInputRef",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:t.handleInputConfirm},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleInputConfirm.apply(null,arguments)}},model:{value:t.inputValue,callback:function(e){t.inputValue=e},expression:"inputValue"}}):e("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:t.showInput}},[t._v("+ New Tag")])],2),e("el-form-item",{attrs:{label:"作者",prop:"author"}},[e("el-select",{attrs:{placeholder:"请选择"},model:{value:t.formData.author,callback:function(e){t.$set(t.formData,"author",e)},expression:"formData.author"}},t._l(t.authors,(function(t){return e("el-option",{key:t.id,attrs:{label:t.author,value:t.author}})})),1)],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("立即创建")]),e("el-button",{on:{click:t.resetForm}},[t._v("重置")])],1)],1)],1),t.submitSuccess?e("el-card",{attrs:{id:"preview-blog-card"}},[e("el-descriptions",{attrs:{title:"博客总览",column:1,direction:"vertical"}},[e("el-descriptions-item",{attrs:{label:"博客标题"}},[e("p",[t._v(t._s(t.formData.title))])]),e("el-descriptions-item",{attrs:{label:"博客内容"}},[e("div",{directives:[{name:"highlight",rawName:"v-highlight"}],domProps:{innerHTML:t._s(t.previewContent)}})]),e("el-descriptions-item",{attrs:{label:"博客分类"}},t._l(t.formData.categories,(function(s,a){return e("el-tag",{key:a,attrs:{size:"small",type:"success",effect:"dark"}},[t._v(" "+t._s(s)+" ")])})),1),e("el-descriptions-item",{attrs:{label:"博客作者"}},[e("p",[t._v(t._s(t.formData.author))])])],1),e("el-divider",{attrs:{"content-position":"right"}},[t._v(t._s(t.formData.createTime))]),e("el-button",{attrs:{type:"primary"},on:{click:t.cancel}},[t._v("返回")])],1):t._e()],1)},r=[],i=s(8723),o={name:"AddBlog",data(){return{formData:{title:"",content:"",categories:[],author:"",createTime:"",intro:""},rules:{title:[{required:!0,message:"文章标题不能为空",trigger:"blur"}],intro:[{required:!0,message:"描述不能为空",trigger:"blur"}],content:[{required:!0,message:"内容不能为空",trigger:"blur"}],categories:[{type:"array",required:!0,message:"请至少添加一个分类",trigger:"blur"}],author:[{required:!0,message:"请选择一个作者签名",trigger:"change"}]},authors:[],submitSuccess:!1,previewContent:"",inputVisible:!1,inputValue:"",images:{},isSave:!1}},created(){this.getAuthors()},methods:{onSubmit(){if(!this.isSave)return this.$message.warning("请先保存博客内容!");this.formData.createTime=this.$formateDate(),this.$refs.formRef.validate((async t=>{if(!t)return this.$message.warning("请完整填写表单!");const{data:e}=await this.$post("/blog/addBlog",this.formData);if(201!==e.status)return this.$message.error("添加博客失败!");this.$message.success(e.msg),this.previewContent=(0,i.marked)(this.formData.content),this.submitSuccess=!this.submitSuccess}))},resetForm(){this.$refs.formRef.resetFields()},cancel(){this.$router.replace("/")},async getAuthors(){const{data:t}=await this.$get("/author/getAuthors");if(200!==t.status)return this.$message.error("获取作者列表信息失败!");this.authors=t.data},async saveContent(){this.isSave=!0,this.$message.success("内容保存成功!")},showInput(){this.inputVisible=!0,this.$nextTick((()=>{this.$refs.TagInputRef.$refs.input.focus()}))},handleInputConfirm(){let t=this.inputValue;t&&this.formData.categories.push(t),this.inputVisible=!1,this.inputValue=""},handleClose(t){this.formData.categories.splice(this.formData.categories.indexOf(t),1)},async imgAdd(t,e){const s=new FormData;s.append("image",e);const{data:a}=await this.$post("/blog/img",s);if(201!==a.status)return this.$message.error(a.msg);this.$message.success(a.msg),this.$refs.editorRef.$img2Url(t,a.url),this.images[a.url]=a.name},async imdDel(t){const{data:e}=await this.$del(`/blog/img/del/${this.images[t[0]]}`);if(202!==e.status)return this.$message.error(e.msg);this.$message.success(e.msg),delete this.images[t[0]]}}},l=o,n=s(1001),u=(0,n.Z)(l,a,r,!1,null,"0c13beda",null),c=u.exports}}]);
//# sourceMappingURL=893.5cd49c1b.js.map